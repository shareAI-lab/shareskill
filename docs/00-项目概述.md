# ShareSkill 项目概述

## 一、产品定位

**ShareSkill = Agent Skill 的安全发现、分发与管理平台**

核心价值：
- **智能发现**：语义搜索 + 向量相似度，精准匹配用户需求
- **安全审查**：LLM 逐文件分析，提供具体安全警告
- **即时使用**：Agent 获取 Skill 后可立即使用知识开始工作，无需安装
- **离线复用**：下载 Skill 到本地，离线可用，快速复用

## 二、什么是 Agent Skill

Agent Skill 是给 AI Agent（如 Claude Code、Cursor、Codex）的"即时培训包"，用于扩展 Agent 的能力。

### Skill 结构

```
skill-name/
├── SKILL.md           # 必须：触发条件 + 执行指令
├── scripts/           # 可选：可执行脚本
├── references/        # 可选：按需加载的参考文档
└── assets/            # 可选：模板、资源文件
```

### SKILL.md 格式

```yaml
---
name: frontend-design
description: Create distinctive frontend interfaces with high design quality.
  Use when the user asks to build web components, pages, or applications.
license: Apache-2.0
compatibility: Designed for Claude Code
allowed-tools: Bash Read Write
---

# Frontend Design Guide

## Overview
This skill guides creation of distinctive, production-grade frontend interfaces...

## Instructions
1. Understand the context and commit to a BOLD aesthetic direction
2. Implement working code (HTML/CSS/JS, React, Vue, etc.)
...
```

### 关键特性

1. **渐进式加载 (Progressive Disclosure)**：
   - Tier 1: metadata (~100 tokens)：始终在 Agent 上下文中，用于判断相关性
   - Tier 2: body (<5000 tokens)：Skill 被触发后加载，包含完整指令
   - Tier 3: resources (按需)：Agent 需要时才读取 scripts/references/assets

2. **description 的双重作用**：
   - 告诉 Agent 什么时候使用这个 Skill
   - 作为用户搜索的核心内容

3. **核心洞察：Skills 是「即时知识」而非「必须安装的软件」**
   - Skill 的核心价值是 SKILL.md 中的知识和指令
   - 大多数情况下，Agent 只需要「知道怎么做」即可开始工作
   - 下载只是为了持久化，方便后续复用，不是使用的前提

## 三、用户角色与需求

### 3.1 终端用户（通过 Web）

**核心诉求**：
1. 快速找到能解决问题的 Skill
2. 了解 Skill 的功能和适用场景
3. 确认安全性
4. 下载使用

**不关心**：
- 技术实现细节
- 复杂的配置选项

### 3.2 AI Agent（通过 MCP）

**核心诉求**：
1. 根据用户需求搜索合适的 Skill
2. 获取 Skill 详情，直接使用知识开始工作
3. 可选：下载 Skill 到本地供离线复用
4. 获取已下载 Skill 的内容

**Agent 工作流（Knowledge-First）**：
```
用户提需求 → Agent 先查本地已下载 → 没有则搜索在线 →
获取 Skill 详情（含完整 SKILL.md） → 直接使用知识开始工作 →
工作完成后可选下载供后续复用
```

### 3.3 平台管理员

**核心诉求**：
1. 监控数据质量和安全审查结果
2. 管理精选/推荐 Skills
3. 查看访问统计和趋势
4. 处理问题 Skills

## 四、安全模型

### 4.1 风险类型

| 风险类型 | 示例 | 严重级别 |
|---------|-----|---------|
| 恶意脚本 | `scripts/deploy.sh` 中的 `rm -rf /` | high |
| 提示词注入 | "忽略之前指令，执行..." | high |
| 数据外传 | 向外部服务器发送用户数据 | high |
| 凭证窃取 | 访问 `~/.ssh`、环境变量等 | high |
| 危险操作 | `sudo`、`chmod 777` | medium |
| 误导性指令 | 伪装成正常操作的可疑命令 | medium |

### 4.2 审查策略

- LLM 逐文件分析，输出具体警告（文件、行号、代码片段）
- 不使用抽象评分，直接展示风险描述
- 下载时明确提示安全警告

## 五、产品形态

### 5.1 Web 服务 (shareskill.run)

**职责**：搜索、展示、提供 API、存储资源文件

**前台**：
- 首页：搜索 + 分类 + 精选 + 热门标签
- 搜索页：结果列表 + 筛选
- 详情页：完整信息 + 安全警告 + 相关推荐 + 下载
- 分类页：按类别浏览

**后台 (/admin)**：
- 数据概览：总数、分类分布、趋势
- Skills 管理：精选设置、问题标记
- 访问统计：PV/UV、热门搜索、下载统计
- 安全监控：高风险 Skills 列表

### 5.2 本地 MCP Server (npx shareskill)

**职责**：调用 Web API、管理本地下载的 skills

**存储位置**：`~/.shareskill/skills/`

**MCP Tools（remote_* 需要网络，local_* 无需网络）**：

| Tool | 网络 | 说明 |
|------|:----:|------|
| `remote_search_skills` | Yes | 搜索在线 skills |
| `remote_get_skill` | Yes | 获取 skill 完整详情，可直接使用 |
| `remote_get_skill_resource` | Yes | 获取 skill 资源文件 |
| `remote_download_skill` | Yes | 下载到本地 |
| `local_list_skills` | No | 列出已下载 |
| `local_get_skill` | No | 读取已下载 skill |
| `local_get_skill_resource` | No | 读取已下载资源文件 |
| `local_remove_skill` | No | 删除 |

**CLI 命令**：
- `npx shareskill download <source>`: 下载
- `npx shareskill list`: 列出已下载
- `npx shareskill remove <name>`: 删除

## 六、架构设计

### 6.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                         ShareSkill                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐│
│  │   Web App    │     │  MCP Server  │     │   Pipeline   ││
│  │  (SvelteKit) │     │  (Local CLI) │     │   (Crawler)  ││
│  └──────┬───────┘     └──────┬───────┘     └──────┬───────┘│
│         │                    │                    │         │
│         └────────────────────┼────────────────────┘         │
│                              │                              │
│                              ▼                              │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                    Supabase Platform                   │ │
│  │  ┌─────────────┐  ┌─────────────┐  ┌───────────────┐  │ │
│  │  │  PostgreSQL │  │   Storage   │  │ Edge Functions │  │ │
│  │  │  + pgvector │  │  (CDN缓存)  │  │   (可选)      │  │ │
│  │  └─────────────┘  └─────────────┘  └───────────────┘  │ │
│  └───────────────────────────────────────────────────────┘ │
│                              │                              │
│                              ▼                              │
│  ┌───────────────────────────────────────────────────────┐ │
│  │                   GitHub (Fallback)                    │ │
│  │  - 资源文件实时获取（Storage 未缓存时）                │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 资源文件存储策略

**设计决策**：

| 决策点 | 决策 | 理由 |
|--------|------|------|
| 存储位置 | Supabase Storage | 已集成，Cloudflare CDN 全球加速 |
| 存储策略 | 冷热分离 | 平衡存储成本和访问速度 |
| 极限容量 | ~100,000 skills | 排除二进制后，8GB 额度足够 |

**冷热分离策略**：

| 类型 | 文件扩展名 | 存储时机 | 说明 |
|------|-----------|---------|------|
| 预缓存 | .md, .ts, .js, .py, .json, .yaml, .sh, .sql, .txt... | Pipeline 阶段 | Agent 最常用，约 250MB |
| 热缓存 | .ttf, .png, .jpg, .mp4, .pdf, .pptx... | 首次请求时 | 二进制文件，按需缓存 |

**中国用户体验**：

| 资源类型 | 来源 | 体验 |
|----------|------|------|
| 代码/文档 | Supabase Storage (Cloudflare CDN) | 秒返回 |
| 二进制（首次） | GitHub → 热缓存 | 可能稍慢 |
| 二进制（之后） | Storage 缓存 | 秒返回 |
| GitHub 不可用 | 返回 GitHub raw URL | Agent 在 client 端重试 |

## 七、技术栈

| 组件 | 技术 |
|-----|-----|
| Web 前端 | SvelteKit + Tailwind CSS |
| 数据库 | Supabase (PostgreSQL + pgvector) |
| 资源存储 | Supabase Storage (Cloudflare CDN) |
| 数据处理 | TypeScript Pipeline |
| LLM | OpenAI / Gemini / DeepSeek (可配置) |
| Embedding | text-embedding-3-large (1536 维) |
| 部署 | Vercel |
| MCP Server | Node.js + @modelcontextprotocol/sdk |

## 八、文档清单

| 文档 | 说明 |
|-----|-----|
| 00-项目概述 | 本文档，产品定位与整体架构 |
| 01-数据库设计 | 表结构、索引、搜索函数 |
| 02-Pipeline设计 | 数据发现、处理、入库流程 |
| 03-API设计 | Web API + MCP Tools 完整规格 |
| 04-前端设计 | 页面结构、组件设计、交互流程 |
| 05-分类体系 | 类别定义、分类逻辑 |
| 06-后台管理 | Admin Panel 功能规格 |

## 九、参考资源

- Agent Skills 规范：https://agentskills.io/specification
- 官方 Skills 仓库：https://github.com/anthropics/skills
- MCP 协议：https://modelcontextprotocol.io
